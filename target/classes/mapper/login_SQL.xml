<?xml version="1.0"	encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"	
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="login">
	<insert id="join" parameterType="loginDTO">
		<choose>
			<when test="u_grade == 0">
				INSERT INTO user(u_email, u_pw, u_name, u_postcode, u_roadAddress, u_detailAddress, u_extraAddress, u_nickname, u_tel)
				VALUES(#{u_email}, #{u_pw}, #{u_name}, #{u_postcode}, #{u_roadAddress}, #{u_detailAddress}, #{u_extraAddress}, #{u_nickname}, #{u_tel} )
			</when>
			<otherwise>
				INSERT INTO user(u_email, u_pw, u_name, u_postcode, u_roadAddress, u_detailAddress, u_extraAddress, u_nickname, u_tel, u_grade, u_confirm)
				VALUES(#{u_email}, #{u_pw}, #{u_name}, #{u_postcode}, #{u_roadAddress}, #{u_detailAddress}, #{u_extraAddress}, #{u_nickname}, #{u_tel}, #{u_grade}, 0 )
			</otherwise>
		</choose>
	</insert>
	
	<select id="login" parameterType="loginDTO" resultType="loginDTO">
		SELECT * FROM user WHERE u_email = #{u_email} AND u_pw = #{u_pw} AND u_confirm = 1 AND u_resign = 0 AND u_provider = #{u_provider}
	</select>
	
	<select id="findByUserid" parameterType="loginDTO" resultType="loginDTO">
		SELECT * FROM user WHERE u_email = #{u_email} AND u_confirm = 1 AND u_resign = 0 AND u_provider = #{u_provider}
	</select>
	<select id="emailCheck" parameterType="string" resultType="integer">
		SELECT COUNT(*) FROM user WHERE u_email=#{u_email} AND u_provider=""
	</select>
	<select id="nicknameCheck" parameterType="string" resultType="integer">
		SELECT COUNT(*) FROM user WHERE u_nickname=#{u_nickname} AND u_provider=""
	</select>
	<update id="update" parameterType="loginDTO" >
		UPDATE user SET u_pw = #{u_pw}, u_nickname=#{u_nicnkname}, u_roadAddress = #{u_roadAddress},
						u_postcode=#{u_postcode}, u_detailAddress=#{u_detailAddress}, u_extraAddress=#{u_extraAddress}
						WHERE u_eamil=#{u_eamil}
	 </update>
</mapper>