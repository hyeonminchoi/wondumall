<?xml version="1.0"	encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"	
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="product">
	<select id="productList" parameterType="categoryDTO" resultType="productDTO">
		select * 
		from product
		WHERE p_del = 0 AND p_confirm = 1
		<if test="cate_no != 1">
			AND cate_no=#{cate_no} ;
		</if>
	</select>
	<insert id="productAdd" parameterType="productDTO">
		INSERT INTO product (p_name, cate_no, p_description, p_price, p_stock, p_img)
	 	VALUES (#{p_name}, #{cate_no}, #{p_description}, #{p_price}, #{p_stock}, #{p_img})
	</insert>
	<select id="productDetail" parameterType="integer" resultType="productDTO">
		SELECT *
		FROM product
		WHERE p_no = #{p_no}
	</select>
	<insert id="productReview" parameterType="reviewDTO">
		INSERT INTO review (p_no, u_no, r_rating, r_title, r_content)
		VALUES (#{p_no}, #{u_no}, #{r_rating}, #{r_title}, #{r_content})
	</insert>
	<insert id="cartAdd" parameterType="cartDTO">
		INSERT INTO cart (p_no, u_no, p_count)
		VALUES (#{p_no}, #{u_no}, #{p_count})
	</insert>
	<select id="cart" parameterType="integer" resultType="cartDTO">
		SELECT *
		FROM cartview
		WHERE u_no = #{u_no}
	</select>
	<select id="cartCount" parameterType="integer" resultType="integer">
		SELECT COUNT(*)
		FROM cart
		WHERE u_no = #{u_no}
	</select>
	<select id="containProduct" parameterType="cartDTO" resultType="integer">
		SELECT COUNT(*)
		FROM cart
		WHERE p_no = #{p_no} AND u_no = #{u_no}
	</select>
	<update id="cartUpdate"  parameterType="cartDTO">
		UPDATE cart SET p_count = p_count + #{p_count}
		WHERE p_no = #{p_no} AND u_no = #{u_no}
	</update>
	<delete id="cartDelete" parameterType="cartDTO">
		DELETE FROM cart
		WHERE cart_no = #{cart_no}
	</delete>
</mapper>